<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏û‡πâ‡∏≠‡∏¢‡∏ï‡πå‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞</title>

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --teal:#009688;
      --teal-2:#7dac9a;
      --bg:#f8f6f0;
    }
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: var(--bg);
      color: #333;
      margin: 0;
      font-size: 15px;
      padding: 19px;
    }
    header .title {
      font-family: 'Prompt';
      text-align: center;
      color: #00695c;
      font-size: 36px;
      margin-top: 20px;
      margin-bottom: 8px;
    }
    header .subtitle {
      text-align:center;
      font-size:13px;
      color:#666;
      margin-bottom: 18px;
    }
    .center {
      text-align: center;
      margin-bottom: 20px;
    }
    .log-button {
      font-family: 'Prompt';
      background-color: var(--teal-2);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 100px;
      cursor: pointer;
      margin: 6px;
    }
    .log-button.negative { background:#e53935; }
    .log-button.small { padding:6px 8px; font-size:13px; }
    .log-button:hover { filter:brightness(.95); }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #e6eef0;
      text-align: center;
    }
    th {
      background-color: var(--teal);
      color: white;
      font-weight: 600;
      font-family: 'Prompt';
    }
    tbody tr:nth-child(even){ background:#fbfdfe; }
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      z-index: 900;
    }
    .popup {
      background: white;
      border: 2px solid var(--teal);
      padding: 18px;
      width: 340px;
      max-width: calc(100% - 40px);
      position: fixed;
      border-radius: 10px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0px 8px 30px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
      max-height: 80vh;
      overflow-y: auto;
    }
    .popup h2 { margin:0 0 8px 0; color: #00695c; font-size:18px; font-family:'Prompt'; }
    .popup input, .popup select { width: 100%; margin: 8px 0; padding: 8px; font-size:14px; border-radius:8px; border:1px solid #cfdde0; }
    .popup img { width:100%; border-radius:8px; margin-top:6px; }
    .popup .row { display:flex; gap:8px; justify-content: flex-end; margin-top:10px; }
    .note { font-size:13px; color:#666; margin-top:8px; }
    .small-muted { font-size:12px; color:#777; }
    .fixed-type { color:#d84315; font-weight:600; }
    @media (max-width:600px){
      .popup { width: 92%; padding:14px; }
      header .title{ font-size:28px; }
    }

    
    .log-img { max-width: 140px; border-radius:8px; display:block; margin-top:8px; }
    .log-entry { text-align:left; }
  </style>
</head>
<body>

  <header>
    <div class="subtitle">Pondok Bantan Zero Waste</div>
    <div class="title"><b>üåø ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏û‡πâ‡∏≠‡∏¢‡∏ï‡πå‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</b></div>
    
  </header>

  <div class="center">
    <button id="resetButton" class="log-button negative small" title="‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)" style="position:fixed; top:12px; right:12px; z-index:2000;">‡∏•‡πâ‡∏≤‡∏á</button>

    <button class="log-button" onclick="showEntryPopup()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏á</button>
    <button class="log-button" onclick="window.open('graph.html','_blank')">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
  </div>

  <table aria-label="‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô">
    <thead>
      <tr>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
        <th>‡∏ó‡∏¥‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤)</th>
        <th>botton - plastic - other - mix)</th>
        <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°</th>
        <th>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</th>
      </tr>
    </thead>
    <tbody id="student-table"></tbody>
  </table>

  <div id="overlay"></div>


  <div id="popup" class="popup" role="dialog" aria-modal="true" aria-labelledby="historyTitle">
    <h2 id="historyTitle">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞</h2>
    <div id="summary" class="summary-box"></div>

    <div id="logList" style="margin-top:8px;"></div>
    <div class="row" style="margin-top:14px;">
      <button class="log-button" onclick="closePopup()">X</button>
    </div>
  </div>
  
  <div id="entryPopup" class="popup" role="dialog" aria-labelledby="entryTitle">
    <h2 id="entryTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏¥‡πâ‡∏á‡∏Ç‡∏¢‡∏∞</h2>

    <label class="small-muted">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
    <input type="text" id="studentIdInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô 17862">

   <label class="small-muted">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏¢‡∏∞ (‡∏ä‡∏¥‡πâ‡∏ô)<br></label>

<label>‡∏Ç‡∏ß‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</label>
<input type="number" id="qtyA" min="0" value="0">

<label>‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
<input type="number" id="qtyB" min="0" value="0">

<label>‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</label>
<input type="number" id="qtyC" min="0" value="0">

    <div class="row">
      <button class="log-button" onclick="submitEntry(),closeOverlay();">save</button>
      <button class="log-button" onclick="closePopup(),closeOverlay()">cancle</button>
    </div>
  </div>

    


<script>

const scoreMap = {
  "‡∏Ç‡∏ß‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å": 10,
  "‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ": 5,
  "‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ": 3,
  "‡∏ñ‡∏±‡∏á‡∏£‡∏ß‡∏°":0,
  "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": 1,
  "‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô": -1
};

let students = {}; 
let logs = {};
function saveLogs(){
  localStorage.setItem("logs", JSON.stringify(logs));
}

function openOverlay(){ document.getElementById("overlay").style.display = "block"; }
function closeOverlay(){ document.getElementById("overlay").style.display = "none"; }
async function loadStudents(){
  try {
    const res = await fetch('students.json');
    if(!res.ok) throw new Error('not found');
    const data = await res.json();
    data.forEach(s => { if(s.id) students[String(s.id)] = (s.name||"").trim(); });
  } catch(err){
    console.warn("students.json not loaded:", err);
  }
}
function summarizeWaste(entries){
  const sum = { A:0, B:0, C:0, D:0, totalScore:0 };
  const scoreMap = { A:10, B:5, C:3, D:0 };
  entries.forEach(e=>{
    sum.A += e.A || 0;
    sum.B += e.B || 0;
    sum.C += e.C || 0;
    sum.D += e.D || 0;

    sum.totalScore += ( (e.A||0)*scoreMap.A + (e.B||0)*scoreMap.B + (e.C||0)*scoreMap.C + (e.D||0)*scoreMap.D );
  });
  return sum;
}


 

function renderTable(){
  const table = document.getElementById("student-table");
  table.innerHTML = "";

  for(const id in logs){
    const entries = logs[id];
    if(!entries || entries.length === 0) continue;

    const wasteSum = summarizeWaste(entries); 
    const last = entries[entries.length - 1];

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${students[id] || (logs[id].name || "noname")}</td>
      <td>${id}</td>
      <td>${last.time || "-"}</td>
      <td>${wasteSum.A} - ${wasteSum.B} - ${wasteSum.C} - ${wasteSum.D}</td>
      <td>${wasteSum.totalScore}</td>
      <td><button class="log-button small" onclick="showLogs('${id}')">see</button></td>
    `;
    table.appendChild(row);
  }
}

function summarizeLastRound(entries){
  const last = entries[entries.length - 1];
  return {
    A: last.A || 0,
    B: last.B || 0,
    C: last.C || 0,
    D: last.D || 0
  };
}


function closePopup(){
  document.getElementById("popup").style.display = "none";
  document.getElementById("entryPopup").style.display = "none";

  const overlay = document.getElementById("overlay");
  overlay.style.display = "none";
}


function showEntryPopup(){
  document.getElementById("entryPopup").style.display = "block";
  openOverlay();
  document.getElementById("qtyA").value = 0;
document.getElementById("qtyB").value = 0;
document.getElementById("qtyC").value = 0;
document.getElementById("qtyD").value = 0;

}

function submitEntry(){
  const studentId = document.getElementById("studentIdInput").value.trim();
  if(!studentId){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
    return;
  }

  const A = parseInt(document.getElementById("qtyA").value) || 0;
  const B = parseInt(document.getElementById("qtyB").value) || 0;
  const C = parseInt(document.getElementById("qtyC").value) || 0;
  const D = parseInt(document.getElementById("qtyD").value) || 0;

  if(A+B+C+D === 0){
    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏¢‡∏∞");
    return;
  }

  const score =
    A * scoreMap["‡∏Ç‡∏ß‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å"] +
    B * scoreMap["‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ"] +
    C * scoreMap["‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ"];

  if(!logs[studentId]) logs[studentId] = [];

  logs[studentId].push({
    A, B, C, D,
    score,
    time: new Date().toLocaleString("th-TH")
  });

  saveLogs();
  renderTable();
  closePopup();
}

function showLogs(id){
  const entries = logs[id] || [];
  const summaryBox = document.getElementById("summary");
  const sumAll = summarizeWaste(entries);

  summaryBox.innerHTML = `
    <div class="note">
      ‡∏Ç‡∏ß‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å: <b>${sumAll.A}</b> |
      ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ: <b>${sumAll.B}</b> |
      ‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: <b>${sumAll.C}</b> |
      ‡∏ñ‡∏±‡∏á‡∏£‡∏ß‡∏°: <b>${sumAll.D}</b> |
      ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <b>${sumAll.totalScore}</b>
    </div>
  `;

  const container = document.getElementById("logList");
  container.innerHTML = "";

  if(entries.length === 0){
    container.innerHTML = "<div class='note'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>";
  } else {
    entries.forEach((e, idx)=>{
      const score = ( (e.A||0)*10 + (e.B||0)*5 + (e.C||0)*3 + (e.D||0)*0 );
      const wrapper = document.createElement("div");
      wrapper.style.marginBottom = "12px";
      wrapper.style.paddingBottom = "8px";
      wrapper.style.borderBottom = "1px solid #eee";

      wrapper.innerHTML = `
        <div class="log-entry">
          ‡∏Ç‡∏ß‡∏î‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å ${e.A} | ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ ${e.B} | ‡∏Ç‡∏¢‡∏∞‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ${e.C} | ‡∏ñ‡∏±‡∏á‡∏£‡∏ß‡∏° ${e.D} ‚Äî ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <strong>${score}</strong>
        </div>
        <div class="small-muted">‡πÄ‡∏ß‡∏•‡∏≤: ${e.time}</div>
      `;

      container.appendChild(wrapper);
    });
  }

  document.getElementById("popup").style.display = "block";
  openOverlay();
}

document.getElementById("resetButton").addEventListener("click", () => {
  if(!confirm("üö® ‡∏£‡∏∞‡∏ß‡∏±‡∏á! ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î! ")) return;
  const pass = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:");
  const correctPass = "zerowaste80280";
  if(pass !== correctPass){ alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï"); return; }
  if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏à‡∏£‡∏¥‡∏á‡πÜ‡∏ô‡∏∞")) {
    localStorage.removeItem("logs");
    logs = {};
    renderTable();
    alert("üöÄ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  }
});

document.addEventListener("DOMContentLoaded", async () => {
  await loadStudents();   
  await loadLogsFromServer();
});

async function loadLogsFromServer(){
  try {
    const res = await fetch("https://robotwaste-server-2.onrender.com/logs")
;
    if(!res.ok) throw new Error("can not load info from server");
    const data = await res.json();
    logs = data;  
    renderTable(); 
  } catch(err){
    console.error("Error fetching logs:", err);
  }
}

setInterval(loadLogsFromServer, 3000);





document.getElementById("overlay").addEventListener("click", () => {
  closePopup();
});


</script>

</body>
</html>
